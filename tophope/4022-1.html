<!DOCTYPE html>
<html id="XF" lang="ru-RU" dir="LTR" data-app="public" data-template="thread_view" data-container-key="node-474" data-content-key="thread-4022" data-logged-in="false" data-cookie-prefix="xf_" data-style-id="3" class="has-no-js template-thread_view" data-run-jobs="">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Хуки в Windows на Delphi | TopHope</title>
<meta property="og:url" content="https://tophope.ru/threads/%D0%A5%D1%83%D0%BA%D0%B8-%D0%B2-windows-%D0%BD%D0%B0-delphi.4022/" />
<script src="/cdn-cgi/apps/head/pQ0v4jtHsSzdXDC7ZgV1Hu-jjpI.js"></script><link rel="canonical" href="https://tophope.ru/threads/%D0%A5%D1%83%D0%BA%D0%B8-%D0%B2-windows-%D0%BD%D0%B0-delphi.4022/" />
<meta property="og:site_name" content="TopHope" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Хуки в Windows на Delphi" />
<meta property="twitter:title" content="Хуки в Windows на Delphi" />
<meta name="theme-color" content="#e1e8f8" />
<link rel="preload" href="/styles/fonts/fa/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous" />
<link rel="preload" href="/styles/fonts/fa/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous" />
<link rel="preload" href="/styles/fonts/fa/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous" />
<link rel="stylesheet" href="/css.php?css=public%3Anormalize.css%2Cpublic%3Acore.less%2Cpublic%3Aapp.less&amp;s=3&amp;l=3&amp;d=1573891129&amp;k=edf6cfeed2b8b8213808b1692c79649ca17f77fa" />
<link rel="stylesheet" href="/css.php?css=public%3Abb_code.less%2Cpublic%3Afox_avatar_toolbox.less%2Cpublic%3Afox_avt_message_user_details.less%2Cpublic%3Amessage.less%2Cpublic%3Anotices.less%2Cpublic%3Ashare_controls.less%2Cpublic%3Aextra.less&amp;s=3&amp;l=3&amp;d=1573891129&amp;k=9c9b3fb9c13e1f346deda4559f513451c1d64602" />
<script src="/js/xf/preamble.min.js?_v=db17b04c"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-49083153-1"></script>
<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'UA-49083153-1', {
			// 
			
			
		});
	</script>
<script type='text/javascript'>
var xfhtml = document.getElementById('XF');
function addClass(el, className) { if (el.classList) el.classList.add(className); else if (!hasClass(el, className)) el.className += ' ' + className; }
function getCookie(name) { var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)'); return v ? v[2] : null; }
function setCookie(name, value, days) { var d = new Date; d.setTime(d.getTime() + 24*60*60*1000*days); document.cookie = name + "=" + value + ";path=/;expires=" + d.toGMTString(); }
function deleteCookie(name) { setCookie(name, '', -1); }
function applySetting(settingName, settingOn, allowToggle){
	
	// Theme editor is enabled. Check for selected toggle, otherwise apply default
		if(allowToggle === 1){	
			cookie = getCookie(settingName);
			if( (cookie === 'on') || (!cookie && (settingOn === 1)) ){
				addClass(xfhtml, settingName);
			}
		} else if(settingOn === 1){
			addClass(xfhtml, settingName);
		}
	
}


applySetting('focus-fluid', 0, 1);


applySetting('focus-grid', 0, 1);


applySetting('focus-sidebar-sticky', 1, 1);


applySetting('focus-sidebar-flip', 0, 1);





	var backgroundCookie = getCookie('xenfocusBackground-3');
	if(backgroundCookie){ xfhtml.setAttribute('data-focus-bg', '' + backgroundCookie + '');	} else { xfhtml.setAttribute('data-focus-bg', '1'); }

</script>
</head>
<body data-template="thread_view">
<div class='focus-width'><div class="p-pageWrapper" id="top">

<header class="p-header" id="header">
<div class="p-header-inner">
<div class="p-header-content">
<div class="p-header-logo p-header-logo--image">
<a href="/forum/">
<span>
<img src="https://tophope.ru/images/th.png" alt="TopHope" />
</span>
</a>
</div>
<div class='focus-ad'></div>
<div class='focus-wrap-user'>

<div class="p-nav-opposite">
<div class="p-navgroup p-account p-navgroup--guest">
<a href="/login/" class="p-navgroup-link p-navgroup-link--textual p-navgroup-link--logIn" data-xf-click="overlay" data-follow-redirects="on">
<span class="p-navgroup-linkText">Вход</span>
</a>
<a href="/register/" class="p-navgroup-link p-navgroup-link--textual p-navgroup-link--register" data-xf-click="overlay" data-follow-redirects="on">
<span class="p-navgroup-linkText">Регистрация</span>
</a>
<a href="#" class="p-navgroup-link xenfocus-navgroup-icon" rel="nofollow" data-xf-init="tooltip" title="" data-xenfocus-editor>
<i class="fa--xf far fa-toggle-on" aria-hidden="true"></i>
</a>
</div>
<div class="p-navgroup p-discovery">
<a href="/whats-new/" class="p-navgroup-link p-navgroup-link--iconic p-navgroup-link--whatsnew" title="Что нового?">
<i aria-hidden="true"></i>
<span class="p-navgroup-linkText">Что нового?</span>
</a>
<a href="/search/" class="p-navgroup-link p-navgroup-link--iconic p-navgroup-link--search" data-xf-click="menu" data-xf-key="/" aria-label="Поиск" aria-expanded="false" aria-haspopup="true" title="Поиск">
<i aria-hidden="true"></i>
<span class="p-navgroup-linkText">Поиск</span>
</a>
<div class="menu menu--structural menu--wide" data-menu="menu" aria-hidden="true">
<form action="/search/search" method="post" class="menu-content" data-xf-init="quick-search">
<h3 class="menu-header">Поиск</h3>
<div class="menu-row">
<div class="inputGroup inputGroup--joined">
<input type="text" class="input" name="keywords" placeholder="Поиск..." aria-label="Поиск" data-menu-autofocus="true" />
<select name="constraints" class="js-quickSearch-constraint input" aria-label="Search within">
<option value="">Везде</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;}">Темы</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;,&quot;c&quot;:{&quot;nodes&quot;:[474],&quot;child_nodes&quot;:1}}">Этот форум</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;,&quot;c&quot;:{&quot;thread&quot;:4022}}">Эта тема</option>
</select>
</div>
</div>
<div class="menu-row">
<label class="iconic"><input type="checkbox" name="c[title_only]" value="1" /><i aria-hidden="true"></i><span class="iconic-label">Искать только в заголовках</span></label>
</div>
<div class="menu-row">
<div class="inputGroup">
<span class="inputGroup-text" id="ctrl_search_menu_by_member">От:</span>
<input class="input" name="c[users]" data-xf-init="auto-complete" placeholder="Пользователь" aria-labelledby="ctrl_search_menu_by_member" />
</div>
</div>
<div class="menu-footer">
<span class="menu-footer-controls">
<button type="submit" class="button--primary button button--icon button--icon--search"><span class="button-text">Поиск</span></button>
<a href="/search/" class="button"><span class="button-text">Расширенный поиск...</span></a>
</span>
</div>
<input type="hidden" name="_xfToken" value="1583578930,d68600f345a59e48aa2ef264a5c138ee" />
</form>
</div>
</div>
</div>
</div>
</div>
</div>
</header>



<div class="p-nav">
<div class="p-nav-inner">
<div class='focus-mobile-navigation'>
<a class="p-nav-menuTrigger" data-xf-click="off-canvas" data-menu=".js-headerOffCanvasMenu" role="button" tabindex="0">
<i aria-hidden="true"></i>
<span class="p-nav-menuText">Меню</span>
</a>
<div class='focus-mobile-logo'>
<a href="/">

<img src="https://tophope.ru/images/th.png" alt="TopHope" />
</a>
</div>
</div>
<div class='focus-wrap-user hide:desktop'>

<div class="p-nav-opposite">
<div class="p-navgroup p-account p-navgroup--guest">
<a href="/login/" class="p-navgroup-link p-navgroup-link--textual p-navgroup-link--logIn" data-xf-click="overlay" data-follow-redirects="on">
<span class="p-navgroup-linkText">Вход</span>
</a>
<a href="/register/" class="p-navgroup-link p-navgroup-link--textual p-navgroup-link--register" data-xf-click="overlay" data-follow-redirects="on">
<span class="p-navgroup-linkText">Регистрация</span>
</a>
<a href="#" class="p-navgroup-link xenfocus-navgroup-icon" rel="nofollow" data-xf-init="tooltip" title="" data-xenfocus-editor>
<i class="fa--xf far fa-toggle-on" aria-hidden="true"></i>
</a>
</div>
<div class="p-navgroup p-discovery">
<a href="/whats-new/" class="p-navgroup-link p-navgroup-link--iconic p-navgroup-link--whatsnew" title="Что нового?">
<i aria-hidden="true"></i>
<span class="p-navgroup-linkText">Что нового?</span>
</a>
<a href="/search/" class="p-navgroup-link p-navgroup-link--iconic p-navgroup-link--search" data-xf-click="menu" data-xf-key="/" aria-label="Поиск" aria-expanded="false" aria-haspopup="true" title="Поиск">
<i aria-hidden="true"></i>
<span class="p-navgroup-linkText">Поиск</span>
</a>
<div class="menu menu--structural menu--wide" data-menu="menu" aria-hidden="true">
<form action="/search/search" method="post" class="menu-content" data-xf-init="quick-search">
<h3 class="menu-header">Поиск</h3>
<div class="menu-row">
<div class="inputGroup inputGroup--joined">
<input type="text" class="input" name="keywords" placeholder="Поиск..." aria-label="Поиск" data-menu-autofocus="true" />
<select name="constraints" class="js-quickSearch-constraint input" aria-label="Search within">
<option value="">Везде</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;}">Темы</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;,&quot;c&quot;:{&quot;nodes&quot;:[474],&quot;child_nodes&quot;:1}}">Этот форум</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;,&quot;c&quot;:{&quot;thread&quot;:4022}}">Эта тема</option>
</select>
</div>
</div>
<div class="menu-row">
<label class="iconic"><input type="checkbox" name="c[title_only]" value="1" /><i aria-hidden="true"></i><span class="iconic-label">Искать только в заголовках</span></label>
</div>
<div class="menu-row">
<div class="inputGroup">
<span class="inputGroup-text" id="ctrl_search_menu_by_member">От:</span>
<input class="input" name="c[users]" data-xf-init="auto-complete" placeholder="Пользователь" aria-labelledby="ctrl_search_menu_by_member" />
</div>
</div>
<div class="menu-footer">
<span class="menu-footer-controls">
<button type="submit" class="button--primary button button--icon button--icon--search"><span class="button-text">Поиск</span></button>
<a href="/search/" class="button"><span class="button-text">Расширенный поиск...</span></a>
</span>
</div>
<input type="hidden" name="_xfToken" value="1583578930,d68600f345a59e48aa2ef264a5c138ee" />
</form>
</div>
</div>
</div>
</div>

<nav class='focus-wrap-nav'>
<div class="p-nav-scroller hScroller" data-xf-init="h-scroller" data-auto-scroll=".p-navEl.is-selected">
<div class="hScroller-scroll">
<ul class="p-nav-list js-offCanvasNavSource">
<li>
<div class="p-navEl " data-has-children="true">
<a href="/" class="p-navEl-link p-navEl-link--splitMenu " data-nav-id="EWRporta">Главная</a>
<a data-xf-key="1" data-xf-click="menu" data-menu-pos-ref="< .p-navEl" data-arrow-pos-ref="< .p-navEl" class="p-navEl-splitTrigger" role="button" tabindex="0" aria-label="Toggle expanded" aria-expanded="false" aria-haspopup="true"></a>
<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
<div class="menu-content">

<a href="/whats-new/" class="menu-linkRow u-indentDepth0 js-offCanvasCopy " data-nav-id="EWRporta_whatsnaw">Что нового?</a>
<a href="/whats-new/latest-activity" class="menu-linkRow u-indentDepth0 js-offCanvasCopy " rel="nofollow" data-nav-id="EWRporta_latest">Последняя активность</a>
<a href="/ewr-porta/authors/" class="menu-linkRow u-indentDepth0 js-offCanvasCopy " data-nav-id="EWRporta_authors">Авторы</a>
</div>
</div>
</div>
</li>
<li>
<div class="p-navEl is-selected" data-has-children="true">
<svg data-name="curve" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 6 6"><path d="M0,6H6V0A6,6,0,0,1,0,6Z" /></svg>
<svg data-name="curve" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 6 6"><path d="M6,6H0V0A6,6,0,0,0,6,6Z" /></svg>
<a href="/forum/" class="p-navEl-link p-navEl-link--splitMenu " data-nav-id="forums">Форумы</a>
<a data-xf-key="2" data-xf-click="menu" data-menu-pos-ref="< .p-navEl" data-arrow-pos-ref="< .p-navEl" class="p-navEl-splitTrigger" role="button" tabindex="0" aria-label="Toggle expanded" aria-expanded="false" aria-haspopup="true"></a>
<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
<div class="menu-content">

<a href="/whats-new/posts/" class="menu-linkRow u-indentDepth0 js-offCanvasCopy " data-nav-id="newPosts">Новые сообщения</a>
<a href="/search/?type=post" class="menu-linkRow u-indentDepth0 js-offCanvasCopy " data-nav-id="searchForums">Поиск сообщений</a>
</div>
</div>
</div>
</li>
<li>
<div class="p-navEl " data-has-children="true">
<a href="/whats-new/" class="p-navEl-link p-navEl-link--splitMenu " data-nav-id="whatsNew">Что нового?</a>
<a data-xf-key="3" data-xf-click="menu" data-menu-pos-ref="< .p-navEl" data-arrow-pos-ref="< .p-navEl" class="p-navEl-splitTrigger" role="button" tabindex="0" aria-label="Toggle expanded" aria-expanded="false" aria-haspopup="true"></a>
<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
<div class="menu-content">

<a href="/whats-new/posts/" class="menu-linkRow u-indentDepth0 js-offCanvasCopy " rel="nofollow" data-nav-id="whatsNewPosts">Новые сообщения</a>
<a href="/whats-new/latest-activity" class="menu-linkRow u-indentDepth0 js-offCanvasCopy " rel="nofollow" data-nav-id="latestActivity">Последняя активность</a>
</div>
</div>
</div>
</li>
<li>
<div class="p-navEl " data-has-children="true">
<a href="/members/" class="p-navEl-link p-navEl-link--splitMenu " data-nav-id="members">Пользователи</a>
<a data-xf-key="4" data-xf-click="menu" data-menu-pos-ref="< .p-navEl" data-arrow-pos-ref="< .p-navEl" class="p-navEl-splitTrigger" role="button" tabindex="0" aria-label="Toggle expanded" aria-expanded="false" aria-haspopup="true"></a>
<div class="menu menu--structural" data-menu="menu" aria-hidden="true">
<div class="menu-content">

<a href="/online/" class="menu-linkRow u-indentDepth0 js-offCanvasCopy " data-nav-id="currentVisitors">Текущие посетители</a>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</nav>
<div class='focus-wrap-search'>
<form action="/search/search" method="post">

<div class='focus-search'>
<div class='focus-search-flex'>
<input name="keywords" placeholder="Поиск..." aria-label="Поиск" data-menu-autofocus="true" type="text" />
<div class='focus-search-prefix'><i class="fa--xf far fa-search" aria-hidden="true"></i></div>
</div>
</div>
<div class="focus-search-menu">
<div class="menu-row">
<select name="constraints" class="js-quickSearch-constraint input" aria-label="Search within">
<option value="">Везде</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;}">Темы</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;,&quot;c&quot;:{&quot;nodes&quot;:[474],&quot;child_nodes&quot;:1}}">Этот форум</option>
<option value="{&quot;search_type&quot;:&quot;post&quot;,&quot;c&quot;:{&quot;thread&quot;:4022}}">Эта тема</option>
</select>
</div>
<div class="menu-row">
<label class="iconic"><input type="checkbox" name="c[title_only]" value="1" /><i aria-hidden="true"></i><span class="iconic-label">Искать только в заголовках</span></label>
</div>
<div class="menu-row">
<div class="inputGroup">
<span class="inputGroup-text">От:</span>
<input class="input" name="c[users]" data-xf-init="auto-complete" placeholder="Пользователь" aria-labelledby="ctrl_search_menu_by_member" />
</div>
</div>
<div class="menu-footer">
<span class="menu-footer-controls">
<a href="/search/" class="button"><span class="button-text">Фильтры</span></a>
<button type="submit" class="button--primary button button--icon button--icon--search"><span class="button-text">Поиск</span></button>
</span>
</div>
</div>
<input type="hidden" name="_xfToken" value="1583578930,d68600f345a59e48aa2ef264a5c138ee" />
</form>
</div>
</div>
</div>

<div class="p-sectionLinks">
<div class="p-sectionLinks-inner hScroller" data-xf-init="h-scroller">
<div class="hScroller-scroll">
<ul class="p-sectionLinks-list">
<li>
<div class="p-navEl ">
<a href="/whats-new/posts/" class="p-navEl-link " data-xf-key="alt+1" data-nav-id="newPosts">Новые сообщения</a>
</div>
</li>
<li>
<div class="p-navEl ">
<a href="/search/?type=post" class="p-navEl-link " data-xf-key="alt+2" data-nav-id="searchForums">Поиск сообщений</a>
</div>
</li>
</ul>
</div>
</div>
</div>

<div class='focus-content'>
<div class="p-body">
<div class="p-body-inner">


<div class='focus-breadcrumb'>
<ul class="p-breadcrumbs " itemscope itemtype="https://schema.org/BreadcrumbList">
<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
<a href="/forum/" itemprop="item">
<span itemprop="name">Форумы</span>
</a>
<meta itemprop="position" content="1" />
</li>
<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
<a href="/forum/#sajtostroenie-programmirovanie-instrumentarij.472" itemprop="item">
<span itemprop="name">Сайтостроение, программирование, инструментарий</span>
</a>
<meta itemprop="position" content="2" />
</li>
<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
<a href="/forum/%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5.474/" itemprop="item">
<span itemprop="name">Программирование</span>
</a>
<meta itemprop="position" content="3" />
</li>
</ul>
<ul class='xenfocus-social'>
<li><a href='#vk.com/tophope' target='_blank'></a></li>
</ul>
</div>
<noscript><div class="blockMessage blockMessage--important blockMessage--iconic u-noJsOnly">JavaScript отключён. Чтобы полноценно использовать наш сайт, включите JavaScript в своём браузере.</div></noscript>
<!--[if lt IE 9]><div class="blockMessage blockMessage&#45;&#45;important blockMessage&#45;&#45;iconic">Вы используете устаревший браузер. Этот и другие сайты могут отображаться в нём некорректно.<br />Вам необходимо обновить браузер или попробовать использовать <a href="https://www.google.com/chrome/browser/" target="_blank">другой</a>.</div><![endif]-->
<div class="p-body-header">
<div class="p-title ">
<h1 class="p-title-value">Хуки в Windows на Delphi</h1>
</div>
<div class="p-description">
<ul class="listInline listInline--bullet">
<li>
<i class="fa--xf far fa-user" aria-hidden="true" title="Автор темы"></i>
<span class="u-srOnly">Автор темы</span>
<a href="/members/gcrank.38204/" class="username  u-concealed" dir="auto" data-user-id="38204" data-xf-init="member-tooltip">GCrank</a>
</li>
<li>
<i class="fa--xf far fa-clock" aria-hidden="true" title="Дата начала"></i>
<span class="u-srOnly">Дата начала</span>
<a href="/threads/%D0%A5%D1%83%D0%BA%D0%B8-%D0%B2-windows-%D0%BD%D0%B0-delphi.4022/" class="u-concealed"><time class="u-dt" dir="auto" datetime="2014-08-24T00:34:00+0400" data-time="1408826040" data-date-string="24 Август 2014" data-time-string="00:34" title="24 Август 2014 в 00:34">24 Август 2014</time></a>
</li>
</ul>
</div>
</div>
<div class="p-body-main  ">
<div class="p-body-content">
<div class="p-body-pageContent">
<div class="block block--messages" data-xf-init="" data-type="post" data-href="/inline-mod/">
<div class="block-outer"></div>
<div class="block-outer js-threadStatusField"></div>
<div class="block-container lbContainer" data-xf-init="lightbox select-to-quote" data-message-selector=".js-post" data-lb-id="thread-4022" data-lb-universal="0">
<div class="block-body js-replyNewMessageContainer">
<article class="message message--post js-post js-inlineModContainer  " data-author="GCrank" data-content="post-32006" id="js-post-32006">
<span class="u-anchorTarget" id="post-32006"></span>
<div class="message-inner">
<div class="message-cell message-cell--user">
<section itemscope itemtype="https://schema.org/Person" class="message-user">
<div class="message-userDetails-top">
<h4 class="message-name"><a href="/members/gcrank.38204/" class="username " dir="auto" data-user-id="38204" data-xf-init="member-tooltip" itemprop="name"><span class="username--style56">GCrank</span></a></h4>
<h5 class="userTitle message-userTitle" dir="auto" itemprop="jobTitle">Адекват</h5>
</div>
<div class="message-avatar ">

<div class="message-avatar-wrapper">
<a href="/members/gcrank.38204/" class="avatar avatar--l" data-user-id="38204" data-xf-init="member-tooltip">
<img src="/data/avatars/l/38/38204.jpg?1406996668" alt="GCrank" class="avatar-u38204-l" itemprop="image" />
</a>
</div>
</div>
<div class="message-userDetails">
<h4 class="message-name"><a href="/members/gcrank.38204/" class="username " dir="auto" data-user-id="38204" data-xf-init="member-tooltip" itemprop="name"><span class="username--style56">GCrank</span></a></h4>
<h5 class="userTitle message-userTitle" dir="auto" itemprop="jobTitle">Адекват</h5>
</div>
<div class="message-userExtras">
<dl class="pairs pairs--justified">
<dt>Сообщения</dt>
<dd>94</dd>
</dl>
<dl class="pairs pairs--justified">
<dt>Реакции</dt>
<dd>57</dd>
</dl>
<dl class="pairs pairs--justified">
<dt>Баллы</dt>
<dd>0</dd>
</dl>
</div>
<span class="message-userArrow"></span>
</section>
</div>
<div class="message-cell message-cell--main">
<div class="message-main js-quickEditTarget">
<header class="message-attribution message-attribution--split">
<div class="message-attribution-main">
<a href="/threads/%D0%A5%D1%83%D0%BA%D0%B8-%D0%B2-windows-%D0%BD%D0%B0-delphi.4022/post-32006" class="u-concealed" rel="nofollow">
<time class="u-dt" dir="auto" datetime="2014-08-24T00:34:00+0400" data-time="1408826040" data-date-string="24 Август 2014" data-time-string="00:34" title="24 Август 2014 в 00:34">24 Август 2014</time>
</a>
</div>
<ul class="message-attribution-opposite message-attribution-opposite--list">
<li>
<a href="/threads/%D0%A5%D1%83%D0%BA%D0%B8-%D0%B2-windows-%D0%BD%D0%B0-delphi.4022/post-32006" data-xf-init="share-tooltip" data-href="/posts/32006/share" rel="nofollow">
<i class="fa--xf far fa-share-alt" aria-hidden="true"></i>
</a>
</li>
<li>
<a href="/threads/%D0%A5%D1%83%D0%BA%D0%B8-%D0%B2-windows-%D0%BD%D0%B0-delphi.4022/post-32006" rel="nofollow">
#1
</a>
</li>
</ul>
</header>
<div class="message-content js-messageContent">
<div class="message-userContent lbContainer js-lbContainer " data-lb-id="post-32006" data-lb-caption-desc="GCrank &middot; 24 Август 2014 в 00:34">
<article class="message-body js-selectToQuote">
<div class="bbWrapper"><div class="bbCodeSpoiler">
<button type="button" class="bbCodeSpoiler-button button--longText button" data-xf-click="toggle" data-xf-init="tooltip" title="Нажмите для открытия или закрытия спойлера"><span class="button-text">
<span>Спойлер: <span class="bbCodeSpoiler-button-title">начальная информация </span></span>
</span></button>
<div class="bbCodeSpoiler-content">
<div class="bbCodeBlock bbCodeBlock--spoiler">
<div class="bbCodeBlock-content">Итак, приступим, что же такое механизм хуков в Windows? В операционной системе Windows хуком называется механизм перехвата особой функцией событий (таких как сообщения, ввод с мыши или клавиатуры) до того, как они дойдут до приложения. Эта функция может затем реагировать на события и, в некоторых случаях, изменять или отменять их. Функции, получающие уведомления о событиях, называются фильтрующими функциями и различаются по типам перехватываемых ими событий. Пример - фильтрующая функция для перехвата всех событий мыши или клавиатуры. Если к одному хуку прикреплено несколько фильтрующих функций, Windows реализует очередь функций, причем функция, прикрепленная последней, оказывается в начале очереди, а самая первая функция - в ее конце.<br />
<br />
Когда к хуку прикреплена одна или более функций-фильтров и происходит событие, приводящее к срабатыванию хука, Windows вызывает только первую функцию из очереди функций-фильтров. Вызов каждого следующего обработчика полностью зависит от предыдущего обработчика. Если какой-либо обработчик не вызовет следующий, то целевому окну не придёт искомое сообщение, а следовательно и не будет вызвана его оконная функция.<br />
<br />
Хуки предоставляют мощные возможности для приложений Windows. Приложения могут использовать хуки в следующих целях:<br />
<br />
<ul>
<li data-xf-list-type="ul">Обрабатывать или изменять все сообщения, предназначенные для всех диалоговых окон (dialog box), информационных окон (message box), полос прокрутки (scroll bar), или меню одного приложения (WH_MSGFILTER).</li>
<li data-xf-list-type="ul">Обрабатывать или изменять все сообщения, предназначенные для всех диалоговых окон, информационных окон, полос прокрутки, или меню всей системы (WH_SYSMSGFILTER).</li>
<li data-xf-list-type="ul">Обрабатывать или изменять все сообщения в системе (все виды сообщений), получаемые функциями GetMessage или PeekMessage (WH_GETMESSAGE).</li>
<li data-xf-list-type="ul">Обрабатывать или изменять все сообщения (любого типа), посылаемые вызовом функции SendMessage (WH_CALLWNDPROC).</li>
<li data-xf-list-type="ul">Записывать или проигрывать клавиатурные и мышиные события (WH_JOURNALRECORD, WH_JOURNALPLAYBACK).</li>
<li data-xf-list-type="ul">Обрабатывать, изменять или удалять клавиатурные события (WH_KEYBOARD).</li>
<li data-xf-list-type="ul">Обрабатывать, изменять или отменять события мыши (WH_MOUSE).</li>
<li data-xf-list-type="ul">Реагировать на определенные действия системы, делая возможным разработку приложений компьютерного обучения - computer-based training (WH_CBT).</li>
<li data-xf-list-type="ul">Предотвратить вызов другой функции-фильтра (WH_DEBUG).</li>
</ul>Работа с хуками осуществляется через функции SetWindowsHookEx, UnhookWindowsHookEx, вызов следующего обработчика осуществляется через функцию CallNextHookEx. До версии 3.1 Windows предоставляла для управления хуками функции SetWindowsHook, UnhookWindowsHook, и DefHookProc. Эти функции до сих пор реализованы в Win32, только лишь для совместимости со старыми приложениями, и использовать их в новых проектах не рекомендуется.<br />
Начнём сначала, для установки хука успользуется функция SetWindowsHookEx<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Первый параметр это числовая константа WH_* которая задаёт тип устанавливаемого хука. Второй параметр это адрес функции-фильтра. Третий параметр это хэндл модуля, содержащего фильтрующую функцию. Этот параметр должен быть равен нулю при установке хука на поток, но данное требование не является строго обязательным, как указано в документации. При установке хука для всей системы или для потока в другом процессе, нужно использовать хэндл DLL, содержащей функцию-фильтр. Четвёртый параметр это идентификатор потока, для которого устанавливается хук. Если он не равен нулю, то хук устанавливается только на указанный поток. Если идентификатор равен нулю, то хук устанавливается на всю систему. Некоторые хуки можно ставить как на всю систему, так и на некоторый поток, некоторые хуки можно поставить только на всю систему. Функция возвращает хендл хука, в случае неудачи функция возвратит ноль. Для снятия хука нужно использовать функцию UnhookWindowsHookEx, которая принимает в качестве единственного параметра хендл установленного хука.<br />
Теперь надо сделать небольшое лирическое отступление от данной темы, для лучшего понятия описываемого механизма. В 32-битных (а далее в 64-битных) операционных системах Windows каждый процесс в системе имеет своё собственное обособленное адресное пространство. Обратиться к чужому адресному пространству можно только через несколько API функций и имея определённые привилегии. Т.е. по одному и тому же адресу в разных процессах могут быть совершенно разные данные. Для того чтобы фильтрующая функция могла обработать сообщение, она должна находиться в памяти именно того процесса, которому принадлежит целевое окно и оконная функция. Итак, если хук устанавливается на всю систему, то фильтрующая функция должна быть загружена в каждый процесс, у которого есть хотя бы один цикл сообщений c использованием функций GetMessage или PeekMessage. Единственный стандартный способ загрузки нашего кода в чужой процесс, это использование DLL. Т.е. для нормального функционирования хуков установленных на всю систему необходимо использовать DLL.<br />
<br />
Едем, далее. Все фильтрующие функции должны быть описаны следующим образом:<br />
<br />
LRESULT CALLBACK FilterFunc(int nCode, WPARAM wParam, LPARAM lParam)<br />
Так написано в MSDN. Тип LRESULT это тот же integer, WPARAM и LPARAM это тоже integer. CALLBACK это тоже что и stdcall. Чтобы было понятнее, приведу наиболее правильное и логичное (по моему мнению) объявление на pascal:<br />
Function FilterFunc(Code:integer; wParam, lParam<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="smilie smilie--sprite smilie--sprite8" alt=":D" title="Big grin    :D" data-shortname=":D" />WORD)<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="smilie smilie--sprite smilie--sprite8" alt=":D" title="Big grin    :D" data-shortname=":D" />WORD; stdcall;<br />
Это общий прототип функции для всех типов хуков. Параметры интерпретируются по-разному, в зависимости типа хука. Очень часто встречается одна и та же ошибка: объявление параметра wParam как WORD. Это грубая ошибка, которая приводит к непредсказуемым последствиям в работе хуков, так как тип WORD имеет размерность 16 бит, а DWORD 32 бита, в результате чего половина информации, передаваемая через этот параметр, теряется. Первый параметр во всех типах хуков интерпретируется в основном одинаково: если он меньше нуля, то надо сразу же вызвать следующую функцию через CallNextHookEx, и вернуть результат её вызова. Если код равен HC_ACTION, то можно обработать это сообщение. Впрочем, это только рекомендации и всё полностью зависит от самой функции и программиста, который её написал.<br />
Для вызова следующей функции в очереди хуков предназначена функция CallNextHookEx<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Отличие от оконной функции лишь в первом параметре, который, кстати, в системах семейства Windows NT (Windows NT/XP/2003 и далее) игнорируется. Для того чтобы не передавать дальше обработку сообщения, достаточно просто не вызывать эту функцию в обработчике. В данном случае это сообщение просто блокируется и не приходит адресату.<br />
<br />
Итак, основные сведения о хуках мы получили. Теперь надо приступить к практике. Наиболее часто встречающийся проблемы поднимаемые на форумах программистов, связанный с хуками, это проблемы с написанием клавиатурных шпионов. Именно клавиатурный шпион мы сейчас и напишем.</div>
</div>
</div>
</div>
<div class="bbCodeSpoiler">
<button type="button" class="bbCodeSpoiler-button button--longText button" data-xf-click="toggle" data-xf-init="tooltip" title="Нажмите для открытия или закрытия спойлера"><span class="button-text">
<span>Спойлер: <span class="bbCodeSpoiler-button-title">Клавиатурный шпион</span></span>
</span></button>
<div class="bbCodeSpoiler-content">
<div class="bbCodeBlock bbCodeBlock--spoiler">
<div class="bbCodeBlock-content">Для создания клавиатурного хука нам надо указать код WH_KEYBOARD при вызове функции SetWindowsHookEx. Windows вызывает обработчики хка когда функции GetMessage или PeekMessage собираются вернуть сообщения WM_KEYUP, WM_KEYDOWN.<br />
<br />
Параметр Code может быть равен следующим значениям:<br />
<br />
<ul>
<li data-xf-list-type="ul">HC_ACTION Windows вызывает обработчик с этим кодом при удалении сообщения из очереди.</li>
<li data-xf-list-type="ul">HC_NOREMOVE Windows вызывает обработчик с этим кодом, когда клавиатурное сообщение не удаляется из очереди, потому что приложение вызвало функцию PeekMessage с параметром PM_NOREMOVE. При вызове хука с этим кодом не гарантируется передача действительного состояние клавиатуры. Программист должен знать о возможности возникновения подобной ситуации.</li>
</ul>Параметр wParam в обработчике хука WH_KEYBOARD содержит виртуальный код клавиши (например, VK_F1, VK_RETURN, VK_LEFT). Параметр lParam расшифровывается следующим образом:<br />
<ul>
<li data-xf-list-type="ul">Биты 0-15 содержат количество повторений нажатой клавиш ив случае залипания.</li>
<li data-xf-list-type="ul">Биты 16-23 содержат скан код нажатой клавиши. Это аппаратно зависимый код, который зависит от конкретной клавиатуры.</li>
<li data-xf-list-type="ul">Бит 24 равен единице, если нажатая клавиша является расширенной (функциональной или на цифровой клавиатуре), иначе 0.</li>
<li data-xf-list-type="ul">Биты 25-28 зарезервированы.</li>
<li data-xf-list-type="ul">Бит 29 выставлен, если нажата кнопка Alt.</li>
<li data-xf-list-type="ul">Бит 30 говорит нам о состоянии клавиши до отправки сообщения. Бит равен единице если до этого кнопка до отправки сообщения нажата, если кнопка была до этого не нажата, то бит равен нулю.</li>
<li data-xf-list-type="ul">Бит 31 говорит о текущем состоянии клавиши. Он равен нулю, если кнопка в нажатом состоянии, и единица, если в не нажатом состоянии.</li>
</ul>Как мы будем сохранять введённый текст? Разумеется, самый простой способ это сохранение в файл перехваченного кода нажатой клавиши это сохранение в файл сразу же в функции фильтре. Но операции файлового ввода/вывода это операции не слишком быстрые и это приводит к общему уменьшению производительности системы при вводе какого-либо текста (впрочем, на новых машинах это вряд ли можно заметить). Поэтому мы заведём специальное окно-сервер, которому будем отправлять коды нажатых клавиш, это окно будет получать коды нажатых клавиш и сохранять в своём буфере, и скидывать буфер в файл, когда он будет достигать некоторого размера.<br />
Создание и снятие хука, я думаю, особых проблем не составляет, поэтому сразу приступлю к самому обработчику хука.<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Основная проблема в при написании клавиатурных хуков заключается в том что обработчику хука передаётся только скан код нажатой клавиши и её виртуальный код. Виртуальный код и скан код говорят нам, какая именно клавиша была нажата, но не говорят, что именно было введено. Поясню, даже если мы вводим русский текст, то клавиатурному хуку будут передаваться коды английских клавиш, т.е. мы вводим слово «привет», а обработчику хука будет передано «GHBDTN». Или, например, мы нажимаем на Shift цифру 7 и вводится знак &amp;, но в клавиатурный хук будт передан только код цифры 7. Для того чтобы преобразовать скан код и виртуальный код в текстовый символ, который был введён, необходимо использовать функцию ToAscii (или ToUnicode). Её параметры:<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Первый параметр это виртуальный код, второй это скан код, третий параметр это указатель на массив в котором сохранено состояние клавиатуры, четвёртый это указатель на переменную, в которую будет сохранён символ, пятый параметр это флаг, определяющий, является ли меню активным. Этот параметр должен быть 1, если меню активно, или иначе 0. Функция возвращает количество символов, полученных в результате преобразования. Состояние клавиатуры можно получить через функцию GetKeyboardState.<br />
Вернёмся в нашей фильтрующей функции.<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Сначала мы получаем состояние клавиатуры, потом получаем скан код из параметры LParam и вызываем функцию ToAscii. Если её результат не равен нулю, т.е. если её результат не пустой, то отправляем cсообщение окну-серверу с заголовком «Simple keylogger » (цифры в заголовке нужны только лишь для его уникальности). Сообщение WM_KEYEVENT мы объявили сами<br />
WM_KEYEVENT=WM_USER+1<br />
А вот собственно и сам обработчик сообщения WM_KEYEVENT<br />
procedure TMainForm.KeyMessageHandler(var Msg: TMessage);<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Для получения текстовой расшифровки нажатой клавиши по её скан коду мы воспользовались функцией GetKeyNameText. Полный текст DLL и приложения находится в архиве прилагающемуся к этой статье.<br />
<br />
Если посмотреть получившийся лог, то мы увидим следующий текст в формате &lt;название клавиши, введённый текст&gt;.</div>
</div>
</div>
</div>
<div class="bbCodeSpoiler">
<button type="button" class="bbCodeSpoiler-button button--longText button" data-xf-click="toggle" data-xf-init="tooltip" title="Нажмите для открытия или закрытия спойлера"><span class="button-text">
<span>Спойлер: <span class="bbCodeSpoiler-button-title">Перехват API функций в Delphi с помощью сплайсинга</span></span>
</span></button>
<div class="bbCodeSpoiler-content">
<div class="bbCodeBlock bbCodeBlock--spoiler">
<div class="bbCodeBlock-content">В этой статье я расскажу наиболее действенную методику перехвата API функций - это сплайсинг. Сплайсинг это подмена кода функции. Конечно, есть другой метод перехвата это редактирование таблицы импорта приложения, редактирование таблицы экспорта. Рассказывать буду по порядку.<br />
<br />
Когда вы пишете в своём приложении так<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Вы импортируете функцию статически. Адрес функции прописывается в таблице импорта вашего приложения (допустим, что адрес нашей функции $7BC56010).<br />
адрес значение<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>А при вызове функции происходит так<br />
Push …<br />
push …<br />
call dword ptr [$00405F56]<br />
Следовательно, для перехвата функции нам надо только подменить значение по адресу $00405F56 на своё, а для вызова оригинальной функции получать адрес функции через GetProcAddress. Но приложение может также получить адрес функции через GetProcAddress и вызывать перехватываемую функцию минуя, перехватчик. Данный метод бесперспективен.<br />
<br />
Идём дальше. Что такое сплайсинг? Наша функция находится по адресу $7C80B529 и допустим, что там такой код<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Для перехвата функции от нас требуется только переписать начальный код функции, так чтобы он передавал управление нашему обработчику. Для передачи управления нашему обработчику достаточно всего лишь одной инструкции jmp на абсолютный адрес, на адрес нашего обработчика . Эта инструкция займёт всего лишь 5 байт – сам опкод этой инструкции ($E9) и значение для прыжка. Это значение вычисляется так<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>s - Смещение следующей команды<br />
d - Требуемый адрес для jmp, т.е. адрес обработчика<br />
<br />
Если немного переделать эту формулу, то она будет выглядеть так<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Теперь при каждом вызове целевой функции, всегда будет передаваться управление нашему обработчику. А как теперь вызвать оригинальную функцию? При установке перехвата нам надо сохранять первые 5 байт функции. Для вызова оригинала надо восстанавливать начало функции и вызывать ее, потом снова устанавливать перехват. Объявим структуру в которой будем сохранять первые 5 байт функции:<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Поле Address фактически в этой структуре не нужен (он просто не к чему), поле нужно только для того чтобы было удобнее снимать перехват. Назовём эту структуру «мост» к старой функции.<br />
<br />
Теперь напишем функцию, которая будет устанавливать перехват:<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Мы сначала устанавливает атрибуты доступа к коду функции, так чтобы можно было его переписывать. Потом вычисляем значение для прыжка. Сначала сохраняем начало функции в запись, потом переписываем начало функции. В конце устанавливаем старые атрибуты доступа.<br />
<br />
Теперь напишем функцию, которая будет снимать перехват:<br />
<br />
f<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Я думаю, что здесь всё понятно - просто восстанавливаем начало перехватываемой функции. Адрес перехватываемой функции берём из структуры указатель, на которую передаётся функции в качестве единственного параметра.<br />
<br />
Теперь напишем функцию, которая будет устанавливать перехват по имени функции.<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Едем далее. Описанные выше функции могут перехватывать функции только в текущем процессе. А как нам перехватывать функции в других процессах? Наиболее простой метод это засунуть перехватчик функции в DLL и в коде библиотечной функции устанавливать перехват, если DLL загружается в процесс и снимать перехват, если она выгружается. Тут ещё одна проблема: как заставить другой процесс загрузить нашу DLL. Наиболее простое решение это создание удалённых потоков. Теперь всё по порядку.<br />
<br />
Удалённый поток создаётся функцией CreateRemoteThread.<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Функция потока должна иметь следующие атрибуты<br />
<br />
DWORD WINAPI ThreadFunc(PVOID pvPararn)<br />
У функции только один параметр –это обычный указатель. Теперь проанализируем ситуацию… Думаем…Шевелим мозгами…Функция LoadLibraryA имеет такие же атрибуты. Она принимает указатель на первый символ имени файла DLL (строка должна кончаться символом #0). Следовательно, функция LoadLibraryA полностью подходит для того, что бы она могла выступать в качестве функции потока. Так как она принимает указатель на строку в своём процессе, нам надо будет записать в память чужого процесса нашу строку и именем файла DLL. Это делается функцией WriteProcessMemory. Вот её описание<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Адрес функции LoadLibraryA мы получаем с помощью функции GetProcAddress так библиотеки kernel32.dll и ntdll.dll грузятся во все процессы всегда по одним и тем же адресам, следовательно, адрес, полученный в адресном пространстве нашего процесса, будет действителен и адресном пространстве любого другого процесса. Теперь напишем функцию, которая загружает вашу DLL в адресное пространство чужого процесса.<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Таким образом, мы загрузили свою DLL в чужой процесс. Вообще, внедрение своего кода в чужие процессы это совсем другая история и требует написания отдельной статьи. Вышеприведённый пример это самый простой способ внедриться в чужой процесс. Обычному процессу не разрешается изменение памяти системных процессов, таких как winlogon.exe, lsass.exe, smss.exe, csrss.exe и др. для этого нужна привилегия SeDebugPrivilege. В приложенных к статье исходниках есть функция EnableDebugPrivilege, которая включает эту привилегию для текущего процесса.<br />
<br />
Идём дальше. Теперь у нас мы научились загружать свою DLL в чужой процесс. Но для должного эффекта нам надо перехватывать DLL во всех процессах системы. Но как это сделать. Можно просто перечислять процессы через ToolHelp32 и загружать свою DLL в каждый найденный процесс. Но не приемлемо, так как во вновь созданных процессах функции не будут перехвачены. Но можно каждую секунду перечислять процессы, короче это тоже неприемлемо и очень долгая история. Самый простой метод это воспользоваться тем что предоставляет нам механизм хуков. Когда мы ставим какой-либо глобальный хук с помощью функции SetWindowsHookEx то DLL, в которой находится функция обработчик хука, загружается во все процессы, которые получают сообщения от системы через функции GetMessage и PeekMessage. Каркас DLL с перехватом функций будет выглядеть так примерно так<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Чтобы установить перехват на API функции во всех процессах (во всех GUI процессах) достаточно просто загрузить нашу DLL. Достаточно написать вот такой код:<br />
<br />
<div class="bbCodeBlock bbCodeBlock--screenLimited bbCodeBlock--code">
<div class="bbCodeBlock-title">
Код:
</div>
<div class="bbCodeBlock-content" dir="ltr">
<div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a>or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a>to view codes content!
</div>
</div>
</div>Также следует помнить одну меру предосторожности при установке и снятии перехвата на функции: надо остановить все остальные потоки текущего процесса, так как во время установки перехвата другой поток может вызывать искомую функцию и это приведёт к непредсказуемым последствиям.</div>
</div>
</div>
</div>
<div class="bbCodeSpoiler">
<button type="button" class="bbCodeSpoiler-button button--longText button" data-xf-click="toggle" data-xf-init="tooltip" title="Нажмите для открытия или закрытия спойлера"><span class="button-text">
<span>Спойлер: <span class="bbCodeSpoiler-button-title">Взято из</span></span>
</span></button>
<div class="bbCodeSpoiler-content">
<div class="bbCodeBlock bbCodeBlock--spoiler">
<div class="bbCodeBlock-content"><div class="blockMessage blockMessage--important">Please,
<a href="/login/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-sign-in-alt"></i>
Вход
</a> or
<a href="/register/" data-xf-click="overlay" data-follow-redirects="on"><i class="fas fa-plus-square"></i>
Регистрация
</a> to view URLs content!
</div></div>
</div>
</div>
</div></div>
<div class="js-selectToQuoteEnd">&nbsp;</div>
</article>
</div>
</div>
<footer class="message-footer">
<div class="reactionsBar js-reactionsList ">
</div>
<div class="js-historyTarget message-historyTarget toggleTarget" data-href="trigger-href"></div>
</footer>
</div>
</div>
</div>
</article>
</div>
</div>
<div class="block-outer block-outer--after">
<div class="block-outer-opposite">
<a href="/login/" class="button--link button" data-xf-click="overlay"><span class="button-text">
Войдите или зарегистрируйтесь для ответа.
</span></a>
</div>
</div>
</div>
<div class="blockMessage blockMessage--none">
<div class="shareButtons shareButtons--iconic" data-xf-init="share-buttons" data-page-url="" data-page-title="" data-page-desc="">
<span class="shareButtons-label">Поделиться:</span>
<div class="shareButtons-buttons">
<a class="shareButtons-button shareButtons-button--brand shareButtons-button--facebook" data-href="https://www.facebook.com/sharer.php?u={url}">
<i aria-hidden="true"></i>
<span>Facebook</span>
</a>
<a class="shareButtons-button shareButtons-button--brand shareButtons-button--twitter" data-href="https://twitter.com/intent/tweet?url={url}&amp;text={title}">
<i aria-hidden="true"></i>
<span>Twitter</span>
</a>
<a class="shareButtons-button shareButtons-button--brand shareButtons-button--reddit" data-href="https://reddit.com/submit?url={url}&amp;title={title}">
<i aria-hidden="true"></i>
<span>Reddit</span>
</a>
<a class="shareButtons-button shareButtons-button--brand shareButtons-button--pinterest" data-href="https://pinterest.com/pin/create/bookmarklet/?url={url}&amp;description={title}">
<i aria-hidden="true"></i>
<span>Pinterest</span>
</a>
<a class="shareButtons-button shareButtons-button--brand shareButtons-button--tumblr" data-href="https://www.tumblr.com/widgets/share/tool?canonicalUrl={url}&amp;title={title}">
<i aria-hidden="true"></i>
<span>Tumblr</span>
</a>
<a class="shareButtons-button shareButtons-button--brand shareButtons-button--whatsApp" data-href="https://api.whatsapp.com/send?text={title}&nbsp;{url}">
<i aria-hidden="true"></i>
<span>WhatsApp</span>
</a>
<a class="shareButtons-button shareButtons-button--email" data-href="mailto:?subject={title}&amp;body={url}">
<i aria-hidden="true"></i>
<span>Электронная почта</span>
</a>
<a class="shareButtons-button shareButtons-button--link is-hidden" data-clipboard="{url}">
<i aria-hidden="true"></i>
<span>Ссылка</span>
</a>
</div>
</div>
</div>
</div>
</div>
</div>
<ul class="p-breadcrumbs p-breadcrumbs--bottom" itemscope itemtype="https://schema.org/BreadcrumbList">
<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
<a href="/forum/" itemprop="item">
<span itemprop="name">Форумы</span>
</a>
<meta itemprop="position" content="1" />
</li>
<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
<a href="/forum/#sajtostroenie-programmirovanie-instrumentarij.472" itemprop="item">
<span itemprop="name">Сайтостроение, программирование, инструментарий</span>
</a>
<meta itemprop="position" content="2" />
</li>
<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
<a href="/forum/%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5.474/" itemprop="item">
<span itemprop="name">Программирование</span>
</a>
<meta itemprop="position" content="3" />
</li>
</ul>
</div>
</div>
</div> 

<div class="offCanvasMenu offCanvasMenu--nav js-headerOffCanvasMenu" data-menu="menu" aria-hidden="true" data-ocm-builder="navigation">
<div class="offCanvasMenu-backdrop" data-menu-close="true"></div>
<div class="offCanvasMenu-content">
<div class="offCanvasMenu-header">
Меню
<a class="offCanvasMenu-closer" data-menu-close="true" role="button" tabindex="0" aria-label="Закрыть"></a>
</div>
<div class="p-offCanvasRegisterLink">
<div class="offCanvasMenu-linkHolder">
<a href="/login/" class="offCanvasMenu-link" data-xf-click="overlay" data-menu-close="true">
Вход
</a>
</div>
<hr class="offCanvasMenu-separator" />
<div class="offCanvasMenu-linkHolder">
<a href="/register/" class="offCanvasMenu-link" data-xf-click="overlay" data-menu-close="true">
Регистрация
</a>
</div>
<hr class="offCanvasMenu-separator" />
</div>
<div class="js-offCanvasNavTarget"></div>
</div>
</div>

<footer class="p-footer" id="footer">
<div class="p-footer-inner">
<div class="p-footer-row">
<div class="p-footer-row-main">
<ul class="p-footer-linkList">
<li><a href="/misc/style" data-xf-click="overlay" data-xf-init="tooltip" title="Выбор стиля" rel="nofollow">
<i class="fa--xf far fa-paint-brush" aria-hidden="true"></i> Uniform Dark
</a></li>
<li class='xenfocus-footer-icon'><a href="#" rel="nofollow" data-xf-init="tooltip" title="" data-xenfocus-editor><i class="fa--xf far fa-toggle-on" aria-hidden="true"></i></a></li>
<li><a href="/misc/language" data-xf-click="overlay" data-xf-init="tooltip" title="Выбор языка" rel="nofollow">
<i class="fa--xf far fa-globe" aria-hidden="true"></i> Русский - полный перевод</a></li>
</ul>
</div>
<div class="p-footer-row-opposite">
<ul class="p-footer-linkList">
<li><a href="/help/terms/">Условия и правила</a></li>
<li><a href="/help/privacy-policy/">Политика конфиденциальности</a></li>
<li><a href="/help/">Помощь</a></li>
<li><a href="/forum/-/index.rss" target="_blank" class="p-footer-rssLink" title="RSS"><span aria-hidden="true"><i class="fa--xf far fa-rss" aria-hidden="true"></i><span class="u-srOnly">RSS</span></span></a></li>
</ul>
</div>
</div>
<div class='footer-align'>
<div>
</div>
<div>
</div>
</div>
</div>
</footer>
</div></div> 
<div class='focus-editor-wrap'>
<div class='focus-editor-overlay' data-xenfocus-editor></div>
<div class='focus-editor'>
<div class='focus-editor-scroll'>
<div>
<h4 data-focus-text='Background Picker'></h4>
<div class="focus-picker">
<span data-focus-bg='1'><i></i></span>
<span data-focus-bg='2'><i></i></span>
<span data-focus-bg='3'><i></i></span>
<span data-focus-bg='4'><i></i></span>
<span data-focus-bg='5'><i></i></span>
<span data-focus-bg='6'><i></i></span>
</div>
</div>
<div>
<h4 data-focus-text='Customize layout'></h4>
<div class='focus-editor-panel' data-toggle-class='focus-fluid' data-default='off'>
<div class='focus-editor-toggle'>
<input type='radio' name='focus-width' id='focus-fluid-off' />
<input type='radio' name='focus-width' id='focus-fluid-on' />
<i class='focus-toggle'><i></i></i>
</div>
<div class='focus-editor-text' data-setting-title='Fluid width?' data-setting-desc='Enabling this will increase the width of the site so it occupies the width of your browser. Useful for larger screens.'></div>
</div>
<div class='focus-editor-panel' data-toggle-class='focus-grid' data-default='off'>
<div class='focus-editor-toggle'>
<input type='radio' name='focus-grid' id='focus-grid-off' />
<input type='radio' name='focus-grid' id='focus-grid-on' />
<i class='focus-toggle'><i></i></i>
</div>
<div class='focus-editor-text' data-setting-title='Grid layout?' data-setting-desc='If enabled, the forums will be displayed as a grid instead of a table.'></div>
</div>
<div class='focus-editor-panel' data-toggle-class='focus-sidebar-sticky' data-default='on'>
<div class='focus-editor-toggle'>
<input type='radio' name='focus-sidebar-sticky' id='focus-sidebar-sticky-off' />
<input type='radio' name='focus-sidebar-sticky' id='focus-sidebar-sticky-on' />
<i class='focus-toggle'><i></i></i>
</div>
<div class='focus-editor-text' data-setting-title='Sticky sidebar?' data-setting-desc='If enabled, the sidebar will stick to the top of the screen for easy access.'></div>
</div>
<div class='focus-editor-panel' data-toggle-class='focus-sidebar-flip' data-default='off'>
<div class='focus-editor-toggle'>
<input type='radio' name='focus-sidebar-flip' id='focus-sidebar-flip-off' />
<input type='radio' name='focus-sidebar-flip' id='focus-sidebar-flip-on' />
<i class='focus-toggle'><i></i></i>
</div>
<div class='focus-editor-text' data-setting-title='Flip sidebar?' data-setting-desc='Flip the sidebar between the left and right sides.'></div>
</div>
</div>
</div>
<div class='focus-editor-save'>
<button data-xenfocus-editor data-focus-text='Save'></button>
</div>
</div>
</div>
<div class="u-bottomFixer js-bottomFixTarget">
<ul class="notices notices--bottom_fixer  js-notices" data-xf-init="notices" data-type="bottom_fixer" data-scroll-interval="6">
<li class="notice js-notice notice--primary notice--cookie" data-notice-id="-1" data-delay-duration="0" data-display-duration="0" data-auto-dismiss="0" data-visibility="">
<div class="notice-content">
<div class="u-alignCenter">
На данном сайте используются файлы cookie, чтобы персонализировать контент и сохранить Ваш вход в систему, если Вы зарегистрируетесь.<br />
Продолжая использовать этот сайт, Вы соглашаетесь на использование наших файлов cookie.
</div>
<div class="u-inputSpacer u-alignCenter">
<a href="/account/dismiss-notice" class="js-noticeDismiss button--notice button button--icon button--icon--confirm"><span class="button-text">Принять</span></a>
<a href="/help/cookies" class="button--notice button"><span class="button-text">Узнать больше...</span></a>
</div>
</div>
</li>
</ul>
</div>
<div class="u-scrollButtons js-scrollButtons" data-trigger-type="up">
<a href="#top" class="button--scroll button" data-xf-click="scroll-to"><span class="button-text"><i class="fa--xf far fa-arrow-up" aria-hidden="true"></i><span class="u-srOnly">Сверху</span></span></a>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script>window.jQuery || document.write('<script src="/js/vendor/jquery/jquery-3.3.1.min.js?_v=db17b04c"><\/script>')</script>
<script src="/js/vendor/vendor-compiled.js?_v=db17b04c"></script>
<script src="/js/xf/core-compiled.js?_v=db17b04c"></script>
<script src="/js/xf/code_block-compiled.js?_v=db17b04c"></script>
<script src="/js/xf/notice.min.js?_v=db17b04c"></script>
<script src="/styles/xenfocus/js/xenfocus.js?v="></script>
<script>
		jQuery.extend(true, XF.config, {
			// 
			userId: 0,
			enablePush: true,
			pushAppServerKey: 'BIZeYWKbQ0m+6YFx+ZpbcZZsponh8U0LoyTnKpCDBOfKvxwre0wxo/ELTSt+zg3x9RzdVc5Vt9q2uOYOjB8UUXU=',
			url: {
				fullBase: 'https://tophope.ru/',
				basePath: '/',
				css: '/css.php?css=__SENTINEL__&s=3&l=3&d=1573891129',
				keepAlive: '/login/keep-alive'
			},
			cookie: {
				path: '/',
				domain: '',
				prefix: 'xf_',
				secure: true
			},
			csrf: '1583578930,d68600f345a59e48aa2ef264a5c138ee',
			js: {"\/js\/xf\/code_block-compiled.js?_v=db17b04c":true,"\/js\/xf\/notice.min.js?_v=db17b04c":true,"\/styles\/xenfocus\/js\/xenfocus.js?v=":true},
			css: {"public:bb_code.less":true,"public:fox_avatar_toolbox.less":true,"public:fox_avt_message_user_details.less":true,"public:message.less":true,"public:notices.less":true,"public:share_controls.less":true,"public:extra.less":true},
			time: {
				now: 1583578930,
				today: 1583528400,
				todayDow: 6
			},
			borderSizeFeature: '3px',
			fontAwesomeWeight: 'r',
			enableRtnProtect: true,
			enableFormSubmitSticky: true,
			uploadMaxFilesize: 2097152,
			allowedVideoExtensions: ["m4v","mov","mp4","mp4v","mpeg","mpg","ogv","webm"],
			shortcodeToEmoji: true,
			visitorCounts: {
				conversations_unread: '0',
				alerts_unread: '0',
				total_unread: '0',
				title_count: true,
				icon_indicator: false
			},
			jsState: {},
			publicMetadataLogoUrl: '',
			publicPushBadgeUrl: 'https://tophope.ru/styles/default/xenforo/bell.png'
		});

		jQuery.extend(XF.phrases, {
			// 
			date_x_at_time_y: "{date} в {time}",
			day_x_at_time_y:  "{day} в {time}",
			yesterday_at_x:   "Вчера в {time}",
			x_minutes_ago:    "{minutes} мин. назад",
			one_minute_ago:   "1 минуту назад",
			a_moment_ago:     "Только что",
			today_at_x:       "Сегодня в {time}",
			in_a_moment:      "В настоящее время",
			in_a_minute:      "Менее минуты назад",
			in_x_minutes:     "В течении {minutes} минут",
			later_today_at_x: "Сегодня позже в {time}",
			tomorrow_at_x:    "Завтра в {time}",

			day0: "Воскресенье",
			day1: "Понедельник",
			day2: "Вторник",
			day3: "Среда",
			day4: "Четверг",
			day5: "Пятница",
			day6: "Суббота",

			dayShort0: "Вос",
			dayShort1: "Пон",
			dayShort2: "Вто",
			dayShort3: "Сре",
			dayShort4: "Чет",
			dayShort5: "Пят",
			dayShort6: "Суб",

			month0: "Январь",
			month1: "Февраль",
			month2: "Март",
			month3: "Апрель",
			month4: "Май",
			month5: "Июнь",
			month6: "Июль",
			month7: "Август",
			month8: "Сентябрь",
			month9: "Октябрь",
			month10: "Ноябрь",
			month11: "Декабрь",

			active_user_changed_reload_page: "Ваша сессия истекла. Перезагрузите страницу.",
			server_did_not_respond_in_time_try_again: "Сервер не ответил вовремя. Пожалуйста, попробуйте снова.",
			oops_we_ran_into_some_problems: "Упс! Мы столкнулись с некоторыми проблемами.",
			oops_we_ran_into_some_problems_more_details_console: "Упс! Мы столкнулись с некоторыми проблемами. Пожалуйста, попробуйте позже. Более детальную информацию об ошибке Вы можете посмотреть в консоли браузера.",
			file_too_large_to_upload: "Файл слишком большой для загрузки.",
			uploaded_file_is_too_large_for_server_to_process: "Загруженный файл слишком большой для обработки сервером.",
			files_being_uploaded_are_you_sure: "Файлы все ещё загружаются. Вы действительно хотите отправить эту форму?",
			attach: "Прикрепить файлы",
			rich_text_box: "Текстовое поле с поддержкой форматирования",
			close: "Закрыть",
			link_copied_to_clipboard: "Ссылка скопирована в буфер обмена.",
			text_copied_to_clipboard: "Скопировано в буфер обмена",
			loading: "Загрузка...",

			processing: "Обработка",
			'processing...': "Обработка...",

			showing_x_of_y_items: "Показано {count} из {total} элементов",
			showing_all_items: "Показаны все элементы",
			no_items_to_display: "Нет элементов для отображения",

			push_enable_notification_title: "Push-уведомления для сайта TopHope успешно активированы",
			push_enable_notification_body: "Спасибо за активацию push-уведомлений!"
		});
	</script>
<form style="display:none" hidden="hidden">
<input type="text" name="_xfClientLoadTime" value="" id="_xfClientLoadTime" title="_xfClientLoadTime" tabindex="-1" />
</form>
<script type="text/template" id="xfReactTooltipTemplate">
		<div class="tooltip-content-inner">
			<div class="reactTooltip">
				
					<a href="#" class="reaction reaction--1" data-reaction-id="1"><i aria-hidden="true"></i><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="reaction-sprite js-reaction" alt="Like" title="Like" data-xf-init="tooltip" /></a>
				
					<a href="#" class="reaction reaction--2" data-reaction-id="2"><i aria-hidden="true"></i><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="reaction-sprite js-reaction" alt="Love" title="Love" data-xf-init="tooltip" /></a>
				
					<a href="#" class="reaction reaction--3" data-reaction-id="3"><i aria-hidden="true"></i><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="reaction-sprite js-reaction" alt="Haha" title="Haha" data-xf-init="tooltip" /></a>
				
					<a href="#" class="reaction reaction--4" data-reaction-id="4"><i aria-hidden="true"></i><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="reaction-sprite js-reaction" alt="Wow" title="Wow" data-xf-init="tooltip" /></a>
				
					<a href="#" class="reaction reaction--5" data-reaction-id="5"><i aria-hidden="true"></i><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="reaction-sprite js-reaction" alt="Sad" title="Sad" data-xf-init="tooltip" /></a>
				
					<a href="#" class="reaction reaction--6" data-reaction-id="6"><i aria-hidden="true"></i><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="reaction-sprite js-reaction" alt="Angry" title="Angry" data-xf-init="tooltip" /></a>
				
			</div>
		</div>
	</script>
<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "DiscussionForumPosting",
			"@id": "https:\/\/tophope.ru\/threads\/%D0%A5%D1%83%D0%BA%D0%B8-%D0%B2-windows-%D0%BD%D0%B0-delphi.4022\/",
			"headline": "Хуки в Windows на Delphi",
			"articleBody": "",
			"articleSection": "Программирование",
			"author": {
				"@type": "Person",
				"name": "GCrank"
			},
			"datePublished": "2014-08-24",
			"dateModified": "2014-08-24",
			"image": "https:\/\/tophope.ru\/data\/avatars\/l\/38\/38204.jpg?1406996668",
			"interactionStatistic": {
				"@type": "InteractionCounter",
				"interactionType": "https://schema.org/ReplyAction",
				"userInteractionCount": 0
			}
		}
		</script>
</body>
</html>
